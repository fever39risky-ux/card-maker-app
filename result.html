<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚«ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ (çµæœ)</title>
    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€è¨­å®š (card_maker.htmlã¨åŒã˜) */
        @font-face {
            font-family: 'Mplus1-Bold';
            src: url('fonts/Mplus1-Bold.otf') format('opentype');
            font-weight: bold;
            font-style: normal;
        }

        /* ã‚¹ã‚¿ã‚¤ãƒ«ã¯ç°¡ç•¥åŒ–ã—ã¦ã„ã¾ã™ */
        body { font-family: sans-serif; text-align: center; margin-top: 50px; background-color: #f0f2f5; }
        .container { max-width: 900px; margin: 0 auto; padding: 30px; background-color: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h1 { color: #333; }
        #cardCanvas {
            border: 1px solid #ddd;
            background-color: #eee;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        #downloadLink {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1.1em;
            display: inline-block;
        }
    </style>
</head>
<body onload="drawResultCard()">

    <div class="container">
        <h1>âœ… å®Œæˆï¼âœ¨</h1>
        <p>ç”»åƒã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‹ã‚‰ä¿å­˜ãŒã§ãã¾ã™ã€‚</p>
	<p>Xã«ãƒã‚¹ãƒˆã—ã¦ã¿ã‚“ãªã«è¦‹ã¦ã‚‚ã‚‰ãŠã†ï¼ï¼</p>
        
        <canvas id="cardCanvas"></canvas>
        <a id="downloadLink" href="#" download="my_original_card.png">ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>

	<button id="shareButton" style="
        background-color: #000; 
        color: white; 
        padding: 10px 20px; 
        border-radius: 5px; 
        font-size: 1.1em;
        margin-top: 15px;
        border: none;
        cursor: pointer;
    ">
        <svg viewBox="0 0 24 24" aria-hidden="true" style="fill: white; height: 1.2em; width: 1.2em; vertical-align: middle; margin-right: 5px;">
            <g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.717 6.231zm-1.164 16.597h1.408L7.096 3.99H5.50L17.08 18.847z"></path></g>
        </svg>
        Xã§ã‚·ã‚§ã‚¢ï¼(Web Intent)
    </button>
        
        <p style="margin-top: 30px;"><a href="#" onclick="clearAndGoBack()">â† æˆ»ã£ã¦ä½œã‚Šç›´ã™</a></p>
    </div>

    <script>
        const cardCanvas = document.getElementById('cardCanvas');
        const ctx = cardCanvas.getContext('2d');
        const downloadLink = document.getElementById('downloadLink');
		const shareButton = document.getElementById('shareButton');

        // â˜…â˜…â˜… ã“ã“ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ (card_maker.htmlã¨åŒã˜è¨­å®š) â˜…â˜…â˜…
        const TEMPLATE_PATH = 'card_template/card_template.png';
        
        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’åˆæˆã™ã‚‹ä½ç½®ã¨ã‚µã‚¤ã‚º
        const profileImageX = 69;   
        const profileImageY = 173;   
        const profileImageWidth = 730; 
        const profileImageHeight = 455; 
        
        // ã‚«ãƒ¼ãƒ‰åæç”»è¨­å®š
        const NAME_Y = 145; // ã‚«ãƒ¼ãƒ‰åYåº§æ¨™

        // â˜…â˜…â˜… ã‚«ãƒ¼ãƒ‰åŠ¹æœã®æç”»è¨­å®š â˜…â˜…â˜…
        const EFFECT_X = 80;      // åŠ¹æœãƒ†ã‚­ã‚¹ãƒˆã®é–‹å§‹Xåº§æ¨™ 
        const EFFECT_Y_START = 750; // åŠ¹æœãƒ†ã‚­ã‚¹ãƒˆã®é–‹å§‹Yåº§æ¨™ 
        const EFFECT_MAX_WIDTH = 720; // åŠ¹æœãƒ†ã‚­ã‚¹ãƒˆã®æœ€å¤§å¹…
        const EFFECT_LINE_HEIGHT = 22; // åŠ¹æœãƒ†ã‚­ã‚¹ãƒˆã®è¡Œã®é«˜ã• (ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º36pxã«åˆã‚ã›ã¦èª¿æ•´)

        // â˜…â˜…â˜… ãƒ©ãƒ³ãƒ€ãƒ ã«æŠ½å‡ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ â˜…â˜…â˜…
        const EFFECT_PATTERNS = [
            "è‡ªåˆ†ã®æ‰‹æœ­ã‚’ã™ã¹ã¦å±±æœ­ã«ã‚‚ã©ã—ã¦åˆ‡ã‚‹ã€‚\nãã®å¾Œã€å±±æœ­ã‚’6æšå¼•ãã€‚è‡ªåˆ†ã®ã‚µã‚¤ãƒ‰ã®æ®‹ã‚Šæšæ•°ãŒ6æšãªã‚‰ã€å¼•ãæšæ•°ã¯8æšã«ãªã‚‹ã€‚",
            "è‡ªåˆ†ã®å±±æœ­ã‹ã‚‰ã€ŒãŸã­ãƒã‚±ãƒ¢ãƒ³ã€ã€Œ1é€²åŒ–ãƒã‚±ãƒ¢ãƒ³ã€ã€Œ2é€²åŒ–ãƒã‚±ãƒ¢ãƒ³ã€ã‚’1æšãšã¤é¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€æ‰‹æœ­ã«åŠ ãˆã‚‹ã€‚\nãã—ã¦å±±æœ­ã‚’åˆ‡ã‚‹ã€‚",
            "ç›¸æ‰‹ã®ãƒ™ãƒ³ãƒãƒã‚±ãƒ¢ãƒ³ã‚’1åŒ¹é¸ã³ã€ãƒãƒˆãƒ«ãƒã‚±ãƒ¢ãƒ³ã¨å…¥ã‚Œæ›¿ãˆã‚‹ã€‚",
            "ã“ã®ã‚«ãƒ¼ãƒ‰ã¯ã€è‡ªåˆ†ã®æ‰‹æœ­ã‚’1æšãƒˆãƒ©ãƒƒã‚·ãƒ¥ã—ãªã‘ã‚Œã°ä½¿ãˆãªã„ã€‚\nè‡ªåˆ†ã®æ‰‹æœ­ãŒ6æšã«ãªã‚‹ã‚ˆã†ã«ã€å±±æœ­ã‚’å¼•ãã€‚",
            "è‡ªåˆ†ã®å±±æœ­ã‹ã‚‰é€²åŒ–ãƒã‚±ãƒ¢ãƒ³ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’1æšãšã¤é¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€æ‰‹æœ­ã«åŠ ãˆã‚‹ã€‚\nãã—ã¦å±±æœ­ã‚’åˆ‡ã‚‹ã€‚",
	ã€€ã€€	"è‡ªåˆ†ã®æ‰‹æœ­ã‚’ã™ã¹ã¦ãƒˆãƒ©ãƒƒã‚·ãƒ¥ã—ã€å±±æœ­ã‚’7æšå¼•ãã€‚",
			"è‡ªåˆ†ã®ãƒã‚±ãƒ¢ãƒ³å…¨å“¡ã®HPã‚’ã€ãã‚Œãã‚Œã€Œ40ã€å›å¾©ã™ã‚‹ã€‚",
			"è‡ªåˆ†ã®å±±æœ­ã‚’3æšå¼•ãã€‚",
			"ãŠãŸãŒã„ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€ãã‚Œãã‚Œè‡ªåˆ†ã®æ‰‹æœ­ã‚’ã™ã¹ã¦ã‚¦ãƒ©ã«ã—ã¦åˆ‡ã‚Šã€å±±æœ­ã®ä¸‹ã«ã‚‚ã©ã™ã€‚\nãã®å¾Œã€ãã‚Œãã‚Œè‡ªåˆ†ã®ã‚µã‚¤ãƒ‰ã®æ®‹ã‚Šæšæ•°ã¶ã‚“ã€å±±æœ­ã‚’å¼•ãã€‚",
			"è‡ªåˆ†ã®å±±æœ­ã‹ã‚‰ã€Œã‚°ãƒƒã‚ºã€ã¨ã€Œãƒã‚±ãƒ¢ãƒ³ã®ã©ã†ãã€ã‚’1æšãšã¤é¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€æ‰‹æœ­ã«åŠ ãˆã‚‹ã€‚\nãã—ã¦å±±æœ­ã‚’åˆ‡ã‚‹ã€‚",
			"è‡ªåˆ†ã®ãƒ™ãƒ³ãƒãƒã‚±ãƒ¢ãƒ³ã«ã¤ã„ã¦ã„ã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’2å€‹ã¾ã§é¸ã³ã€ãƒãƒˆãƒ«ãƒã‚±ãƒ¢ãƒ³ã«ã¤ã‘æ›¿ãˆã‚‹ã€‚",
			"è‡ªåˆ†ã®å±±æœ­ã‹ã‚‰ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã‚ºã‚’1æšé¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€æ‰‹æœ­ã«åŠ ãˆã‚‹ã€‚\nãã—ã¦å±±æœ­ã‚’åˆ‡ã‚‹ã€‚",
			"ãŠãŸãŒã„ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€ãã‚Œãã‚Œæ‰‹æœ­ã‚’ã™ã¹ã¦å±±æœ­ã«ã‚‚ã©ã—ã¦åˆ‡ã‚‹ã€‚\nãã®å¾Œã€ãã‚Œãã‚Œå±±æœ­ã‚’4æšå¼•ãã€‚",
			"ç›¸æ‰‹ã®ãƒã‚±ãƒ¢ãƒ³ã‚’1åŒ¹é¸ã³ã€ãã®ãƒã‚±ãƒ¢ãƒ³ã«ã¤ã„ã¦ã„ã‚‹ã€Œãƒã‚±ãƒ¢ãƒ³ã®ã©ã†ãã€ã¨ã€Œç‰¹æ®Šã‚¨ãƒãƒ«ã‚®ãƒ¼ã€ã‚’1æšãšã¤ãƒˆãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚",
			"è‡ªåˆ†ã®å±±æœ­ã‹ã‚‰ãŸã­ãƒã‚±ãƒ¢ãƒ³ã‚’2æšã¾ã§ã€ã¾ãŸã¯é€²åŒ–ãƒã‚±ãƒ¢ãƒ³ã‚’1æšé¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€æ‰‹æœ­ã«åŠ ãˆã‚‹ã€‚\nãã—ã¦å±±æœ­ã‚’åˆ‡ã‚‹ã€‚",
			"ã“ã®ã‚«ãƒ¼ãƒ‰ã¯ã€å…ˆæ”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æœ€åˆã®ç•ªã§ã‚‚ä½¿ãˆã‚‹ã€‚\n\nè‡ªåˆ†ã®æ‰‹æœ­ã‚’ã™ã¹ã¦ãƒˆãƒ©ãƒƒã‚·ãƒ¥ã—ã€å±±æœ­ã‚’5æšå¼•ãã€‚",
			"è‡ªåˆ†ã®ãƒˆãƒ©ãƒƒã‚·ãƒ¥ã‹ã‚‰ãƒã‚±ãƒ¢ãƒ³ï¼ˆã€Œãƒ«ãƒ¼ãƒ«ã‚’æŒã¤ãƒã‚±ãƒ¢ãƒ³ã€ã‚’ã®ããï¼‰ã¨åŸºæœ¬ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’åˆè¨ˆ3æšã¾ã§é¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€æ‰‹æœ­ã«åŠ ãˆã‚‹ã€‚",
			"è‡ªåˆ†ã®å±±æœ­ã‹ã‚‰ã€ãã‚Œãã‚Œã¡ãŒã†ã‚¿ã‚¤ãƒ—ã®åŸºæœ¬ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’2æšã¾ã§é¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€ã©ã¡ã‚‰ã‹1æšã‚’æ‰‹æœ­ã«åŠ ãˆã€æ®‹ã‚Šã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è‡ªåˆ†ã®ãƒã‚±ãƒ¢ãƒ³ã«ã¤ã‘ã‚‹ã€‚\nãã—ã¦å±±æœ­ã‚’åˆ‡ã‚‹ã€‚",
			"è‡ªåˆ†ã®å±±æœ­ã‹ã‚‰ã‚¹ã‚¿ã‚¸ã‚¢ãƒ ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’1æšãšã¤é¸ã³ã€ç›¸æ‰‹ã«è¦‹ã›ã¦ã€æ‰‹æœ­ã«åŠ ãˆã‚‹ã€‚\nãã—ã¦å±±æœ­ã‚’åˆ‡ã‚‹ã€‚",
			"ã“ã®ã‚«ãƒ¼ãƒ‰ã¯ã€è‡ªåˆ†ã®æ‰‹æœ­ã‚’1æšãƒˆãƒ©ãƒƒã‚·ãƒ¥ã—ãªã‘ã‚Œã°ä½¿ãˆãªã„ã€‚\n\nç›¸æ‰‹ã®ãƒ™ãƒ³ãƒãƒã‚±ãƒ¢ãƒ³ã®æ•°ã¶ã‚“ã€è‡ªåˆ†ã®å±±æœ­ã‚’å¼•ã",
    		];
        // â˜…â˜…â˜… ã“ã“ã¾ã§èª¿æ•´ã—ã¦ãã ã•ã„ â˜…â˜…â˜…

        let cardBaseImage = new Image();

        /**
         * ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒã‚’èª­ã¿è¾¼ã¿ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦æç”»ã™ã‚‹
         */
        function drawResultCard() {
            const cardName = sessionStorage.getItem('cardName');
            const imageDataURL = sessionStorage.getItem('imageDataURL');

            if (!cardName || !imageDataURL) {
                alert("ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…¥åŠ›ç”»é¢ã«æˆ»ã‚Šã¾ã™ã€‚");
                window.location.href = 'card_maker.html';
                return;
            }

            // 1. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰
            const uploadedProfileImage = new Image();
            uploadedProfileImage.onload = () => {
                // 2. ãƒ™ãƒ¼ã‚¹ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰
                cardBaseImage.onload = () => {
                    cardCanvas.width = cardBaseImage.width;
                    cardCanvas.height = cardBaseImage.height;
                    
                    // 3. å…¨ã¦ã®ç”»åƒãŒæƒã£ãŸã‚‰åˆæˆã‚’å®Ÿè¡Œ
                    renderCard(cardName, uploadedProfileImage);
                };
                cardBaseImage.onerror = () => {
                    alert("ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”»åƒãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                };
                cardBaseImage.src = TEMPLATE_PATH;
            };
            uploadedProfileImage.src = imageDataURL;
        }

        /**
         * æœ€çµ‚çš„ãªåˆæˆå‡¦ç†
         */
        function renderCard(cardName, uploadedProfileImage) {
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢ã—ã€ã‚«ãƒ¼ãƒ‰ã®ãƒ™ãƒ¼ã‚¹ç”»åƒã‚’æç”»
            ctx.clearRect(0, 0, cardCanvas.width, cardCanvas.height);
            ctx.drawImage(cardBaseImage, 0, 0, cardCanvas.width, cardBaseImage.height);

            // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚’åˆæˆ
            ctx.drawImage(
                uploadedProfileImage,
                profileImageX,
                profileImageY,
                profileImageWidth,
                profileImageHeight
            );

            // â˜…â˜…â˜… ã‚«ãƒ¼ãƒ‰åæç”»ãƒ­ã‚¸ãƒƒã‚¯ â˜…â˜…â˜…
            if (cardName.trim() !== "") {
                ctx.fillStyle = '#000';
                ctx.font = 'bold 48px "Mplus1-Bold", sans-serif'; 
                ctx.textAlign = 'left';
                ctx.fillText(cardName, 80, NAME_Y); 
            }
            // â˜…â˜…â˜… ã“ã“ã¾ã§ã‚«ãƒ¼ãƒ‰åæç”»ãƒ­ã‚¸ãƒƒã‚¯ â˜…â˜…â˜…

            // â˜…â˜…â˜… è¿½åŠ : ã‚«ãƒ¼ãƒ‰åŠ¹æœã®ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡ºã¨æç”» â˜…â˜…â˜…
            const randomIndex = Math.floor(Math.random() * EFFECT_PATTERNS.length);
            const randomEffectText = EFFECT_PATTERNS[randomIndex];

            ctx.fillStyle = '#000'; 
            ctx.font = '18px sans-serif'; 
            ctx.textAlign = 'left'; 

            wrapText(
                ctx,
                randomEffectText,
                EFFECT_X,
                EFFECT_Y_START,
                EFFECT_MAX_WIDTH,
                EFFECT_LINE_HEIGHT
            );

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’æ›´æ–°
            const dataURL = cardCanvas.toDataURL('image/png');
            downloadLink.href = dataURL;
        }

		/**
         * XæŠ•ç¨¿ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹é–¢æ•°
         */
        function setupShareButton(cardName, effectText) {
            shareButton.addEventListener('click', () => {
                // ã“ã“ã¯GitHub Pagesã§å…¬é–‹ã•ã‚ŒãŸURLã«ç½®ãæ›ãˆã¦ãã ã•ã„
                const appURL = encodeURIComponent(window.location.protocol + "//" + window.location.host + "/card_maker.html");
                
                const shareText = 
                    `ğŸ‰ ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚«ãƒ¼ãƒ‰ãŒå®Œæˆï¼\n` +
                    `ã‚«ãƒ¼ãƒ‰å: ${cardName}\n` +
                    `åŠ¹æœ: ${effectText.substring(0, 50)}...\n\n` + // åŠ¹æœã®å†’é ­50æ–‡å­—
                    `ç”»åƒã‚’ä¿å­˜ã—ã¦ã€ã“ã®æŠ•ç¨¿ã¨ä¸€ç·’ã«ã‚·ã‚§ã‚¢ã—ã‚ˆã†ï¼\n` +
                    `#ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚«ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼\n\n` +
                    `ğŸ”½ ã‚ãªãŸã®ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚‹ ğŸ”½\n` +
                    `${decodeURIComponent(appURL)}`; // URLã‚’ãã®ã¾ã¾å«ã‚ã‚‹

                const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;
                
                window.open(twitterUrl, '_blank');
            });
        }
		
        /**
         * ãƒ†ã‚­ã‚¹ãƒˆã‚’æœ€å¤§å¹…ã«åˆã‚ã›ã¦è‡ªå‹•ã§æ”¹è¡Œã™ã‚‹é–¢æ•°
         */
        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const chars = text.split('');
            let line = '';
            let currentY = y;
            
            for (let i = 0; i < chars.length; i++) {
                const char = chars[i];
                
                if (char === '\n') {
                    context.fillText(line, x, currentY);
                    line = '';
                    currentY += lineHeight;
                    continue;
                }
                
                let testLine = line + char;
                const testWidth = context.measureText(testLine).width;
                
                if (testWidth > maxWidth) {
                    context.fillText(line, x, currentY);
                    line = char;
                    currentY += lineHeight;
                } else {
                    line = testLine;
                }
            }
            context.fillText(line, x, currentY);
        }

		function clearAndGoBack() {
    // æˆ»ã‚‹å‰ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
    sessionStorage.removeItem('cardName');
    sessionStorage.removeItem('imageDataURL');
    // card_maker.html ã«ç§»å‹•
    window.location.href = 'index.html';
}
    </script>
</body>
</html>






